# 项目说明文档

## 目标描述
本项目旨在设计并实现一个高效的Linux内核模块,该模块将创建一个新的文件系统,并实现与VFS(虚拟文件系统)的接口对接.此文件系统将具备以下核心功能:

- 管理文件系统的超级块、dentry、inode的读写操作.
- 根据用户权限提供不同的操作属性.
- 与用户态程序进行有效对接.
- 支持文件/目录的创建和删除、读写文件、权限管理、硬链接和软链接的创建,以及访问时间和权限的修改.

此外,项目还包括设计一个用户态应用程序,用于将块设备格式化为新设计的文件系统格式,并开发一个测试用例应用程序,以验证文件系统的基本操作.

**本项目均已完成并实现**

## 比赛题目分析和相关资料调研

在项目开始阶段,我们对Linux内核模块的开发、文件系统的工作原理、VFS接口以及FUSE(用户态文件系统)进行了深入研究.通过分析现有的文件系统实现和FUSE的文档,我们确定了项目的技术路线和创新点.

详细的技术文档见 `md-docs/`, 在线阅读: [kfs document](https://luzhixing12345.github.io/kfs/)

## 系统框架设计

系统设计分为内核模块和用户态程序两部分:
1. **内核模块**:负责实现文件系统的接口与 VFS 对接, 传递消息数据传递给上层用户态程序处理, 这部分由 FUSE 的内核驱动管理.
2. **用户态程序**:包括inode和dentry的管理、权限控制、文件操作等, 这部分是我们的 kfs 文件系统实现的功能. 本项目还是实现了一个磁盘格式化工具 `mkfs` , 可以实现文件系统的格式化和功能测试, 

我们采用了高效的缓存策略,重新设计了cache/bitmap/dcache/dentry部分,以减少磁盘I/O和内存拷贝.

## 开发计划
开发计划分为以下几个阶段:
1. **需求分析与设计**:明确功能需求,设计系统架构.
2. **用户态程序开发**:开发格式化工具和测试用例应用程序.
3. **测试与验证**:对内核模块和用户态程序进行测试,确保功能正确性.
4. **性能优化**:根据测试结果进行性能调优.
5. **文档编写**:编写项目文档,包括设计说明和用户手册.

## 比赛过程中的重要进展

- 完成文件系统的基本操作.
- 高效的缓存机制显著提升了文件系统性能.
- 完善测试程序, 修复bug, 添加文档和注释.
- 完成用户态程序 mkfs 并可以正确格式化块设备.

## 系统测试情况
测试覆盖了文件系统的所有基本功能,包括:
- 文件的创建、删除、读写.
- 目录的创建、删除和遍历.
- 权限管理,确保不同用户具有相应的访问权限.
- 硬链接和软链接的创建和管理.
- 访问时间和权限的修改.

## 遇到的主要问题和解决方法
- **问题1**:日志部分尚未完成.
  - **解决方法**:后续调研学习一下 ext4 的日志格式.
- **问题2**:并发场景下会出现问题.
  - **解决方法**:优化缓存算法,引入锁机制以支持并发访问.
- **问题3**: 超大文件的读写有问题
  - **解决办法**: 完善 ext4 extent 部分并进行相关测试
- **问题4**: inode/data block 选择
  - **解决办法**: 调研相关算法, 选择更好的分配策略

## 分工和协作
项目团队成员根据各自的专长进行了分工:
- 文件系统开发:陆知行负责核心功能的实现.
- 磁盘格式化程序开发:陈阳负责格式化工具和测试用例的编写.
- 系统测试与优化, 文档编写:王耀慧负责测试工作和性能优化.

团队成员通过定期会议和代码审查确保项目的顺利进行.

## 提交仓库目录和文件描述
- `/src/`:包含文件系统的源代码.
- `/mkfs/`:包含磁盘格式化源代码.
- `/md-docs/`:包含项目技术文档.
- `/docs/`:包含项目在线文档.
- `/script/`:包含一些小脚本
- `/test/`: 一些测试用例

## 比赛收获
通过参与此次项目,团队成员在文件系统设计、性能优化等方面积累了宝贵的经验.此外,团队协作和问题解决能力也得到了显著提升.